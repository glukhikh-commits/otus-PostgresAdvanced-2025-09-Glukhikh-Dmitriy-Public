### 1. Устанавка Yandex Cloud CLI (yc).
```
curl -sSL https://storage.yandexcloud.net/yandexcloud-yc/install.sh
```
### 2. Запуск первоначальной настройки yc: авторизации, выбор облака, каталога и зоны доступности.
```
yc-init
```
### 3. Создание виртуальной частной сети.
```
yc vpc network create --name otus-net --description "otus-net"
```
### 4. Создание подсети в этой сети для размещения виртуальных машин.
```
yc vpc subnet create --name otus-subnet --range 192.168.0.0/24 --network-name otus-net --description "otus-subnet"
```

### 5.  Создание виртуальной машины с 2 ядрами, 4 ГБ памяти, диском 15 ГБ на Ubuntu 24.04.
```
yc compute instance create --name otus-vm --hostname otus-vm --cores 2 --memory 4 --create-boot-disk size=15G,type=network-hdd,image-folder-id=standard-images,image-family=ubuntu-2404-lts --network-interface subnet-name=otus-subnet,nat-ip-version=ipv4 --ssh-key ~/.ssh/yc_key.pub 
```

### 6. Получение публичного IP-адреса виртуальной машины otus-vm и подключение по SSH.
```
vm_ip_address=$(yc compute instance show --name otus-vm | grep -E ' +address' | tail -n 1 | awk '{print $2}') && ssh -o StrictHostKeyChecking=no -i ~/.ssh/yc_key yc-user@$vm_ip_address 
```

### 7. Установка PostgreSQL, подключение к БД и установка пароля.
```
sudo apt update && sudo apt upgrade -y -q && sudo sh -c 'echo "deb http://apt.postgresql.org/pub/repos/apt $(lsb_release -cs)-pgdg main" > /etc/apt/sources.list.d/pgdg.list' && wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo apt-key add - && sudo apt-get update && sudo apt -y install postgresql 
```
```
sudo -u postgres psql
psql (18.1 (Ubuntu 18.1-1.pgdg24.04+2))
Type "help" for help.

postgres=#\password
```
### 8. Создание таблицы с перевозками.
```
create table shipments(id serial, product_name text, quantity int, destination text);
CREATE TABLE
postgres=# insert into shipments(product_name, quantity, destination) values('bananas', 1000, 'Europe');
insert into shipments(product_name, quantity, destination) values('bananas', 1500, 'Asia');
insert into shipments(product_name, quantity, destination) values('bananas', 2000, 'Africa');
insert into shipments(product_name, quantity, destination) values('coffee', 500, 'USA');
insert into shipments(product_name, quantity, destination) values('coffee', 700, 'Canada');
insert into shipments(product_name, quantity, destination) values('coffee', 300, 'Japan');
insert into shipments(product_name, quantity, destination) values('sugar', 1000, 'Europe');
insert into shipments(product_name, quantity, destination) values('sugar', 800, 'Asia');
insert into shipments(product_name, quantity, destination) values('sugar', 600, 'Africa');
insert into shipments(product_name, quantity, destination) values('sugar', 400, 'USA');
```
### 9. Создание внешнего диска в Yandex Cloud.
```
- Идентификаторep d48erdtihln98d1pql
- Имя disk-1770366621982
- Виртуальные машины otus-vm
- Размер 15 ГБ
- Размер блока 4 КБ
- Тип HDD
```
```
lsblk 
NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINTS 
vda 253:0 0 15G 0 disk 
├─vda1 253:1 0 14.4G 0 part /
├─vda14 253:14 0 4M 0 part 
└─vda15 253:15 0 600M 0 part /boot/efi 
vdb 253:16 0 15G 0 disk
```
### 10. Создание раздела vdb1 на диске vdb.
```
sudo fdisk /dev/vdb

Welcome to fdisk (util-linux 2.39.3).
Changes will remain in memory only, until you decide to write them.
Be careful before using the write command.
```
```
Command (m for help): n
Partition type
   p   primary (0 primary, 0 extended, 4 free)
   e   extended (container for logical partitions)
Select (default p): p
Partition number (1-4, default 1): 1
First sector (2048-31457279, default 2048): 
Last sector, +/-sectors or +/-size{K,M,G,T,P} (2048-31457279, default 31457279): 

Created a new partition 1 of type 'Linux' and of size 15 GiB.

Command (m for help): w
The partition table has been altered.
Calling ioctl() to re-read partition table.
Syncing disks.
``` 
```
yc-user@otus-vm:~$ lsblk
NAME    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
vda     253:0    0   15G  0 disk 
├─vda1  253:1    0 14.4G  0 part /
├─vda14 253:14   0    4M  0 part 
└─vda15 253:15   0  600M  0 part /boot/efi
vdb     253:16   0   15G  0 disk 
└─vdb1  253:17   0   15G  0 part 
```
### 11. Перенос данных на новый диск.
```
sudo mkdir /mnt/pgdata
sudo mount /dev/vdb1 /mnt/pgdata
```
```
sudo rsync -av /var/lib/postgresql/ /mnt/pgdata/
``` 
### 12. Редактирование конфигурационного файла
```
sudo nano /etc/postgresql/18/main/postgresql.conf
```
```
data_directory = '/mnt/pgdata/15/main'
```
### 13. Проверка, что данные сохранились и доступны.
```
postgres=# select * from shipments;
 id | product_name | quantity | destination 
----+--------------+----------+-------------
  1 | bananas      |     1500 | Asia
  2 | bananas      |     2000 | Africa
  3 | coffee       |      500 | USA
  4 | coffee       |      700 | Canada
  5 | coffee       |      300 | Japan
  6 | sugar        |     1000 | Europe
  7 | sugar        |      800 | Asia
  8 | sugar        |      600 | Africa
  9 | sugar        |      400 | USA
(9 rows)
```
```
postgres=# SHOW data_directory;
   data_directory    
---------------------
 /mnt/pgdata/18/main
(1 row)
```